# Docker

- **도커란**
    
    컨테이너 기반의 오픈소스 가상화 플랫폼이다.
    
    기본 하드웨어에서 격리된 환경에 애플리케이션을 배치하는 것이다. 기존 가상화 기술은 하이퍼바이저 (호스트 컴퓨터에서 다수의 운영체제를 동시에 실행하기 위한 논리적 플랫폼)와 게스트 OS가 필요하지만, 도커는 이를 필요로 하지 않아 가볍다. 
    
- **컨테이너**
    - **리눅스 컨테이너**
        
        리눅스 컨테이너는 격리된 공간에서 프로세스를 동작하는 기술이다. 격리하는데 사용하는 기술은 리눅스의 cgroups와 namespace이다.
        
        - **Namespace**
            
            네임스페이스란 프로세스를 실행할 때, 시스템의 리소스를 접근을 제어할 수 있는 기능이다. 시스템의 리소스를 분리해서 실행하도록 할 수 있다.
            
            모든 프로세스에는 다음과 같은 여러 네임스페이스가 있다. cgroup, pid, user, uts, ipc, mnt, net
            
        - **Cgroup(control group)**
            
            프로세스의 그룹으로 컨테이너 안의 모든 프로세스는 같은 cgroup에 있다. cgroup 내에서는 메모리와 CPU 제한이 있어, 호스트 운영체제에 의해 관리받는다. 
            
    - **도커 컨테이너**
        
        도커 컨테이너는 이러한 리눅스 컨테이너 기술에 기반해 만들어 졌다. 도커 컨테이너들은 리눅스 VM위에서 작동하며, 동일한 리눅스 커널을 공유한다. 리눅스 컨테이너와의 차이점은 도커컨테이너는 단일 프로세스로 실행되도록 제한하며, stateless(영구스토리지를 지원하지 않고, 읽기 전용)하며, 이식성(네트워킹, 스토리지, OS세부요소를 추상화)이 뛰어나다.
        
        이미지의 관점에서 이미지가 클래스라면, 도커 컨테이너는 이미지의 실행가능한 인스턴스이다.
        
        [https://www.itworld.co.kr/news/105426](https://www.itworld.co.kr/news/105426)
        
- **이미지**
    
    컨테이너를 만드는 지침이 포함된 읽기전용 템플릿이며, 도커파일을 통해 정의한다. 
    
    도커파일을 만들면, 베이스 레이어(ex. 우분투)에 우리가 지시한(ex. nginx 설치) 레이어들이 모두 이미지 레이어가 된다. 이미지를 실행하면, 컨테이너 레이어가 생기며, 우리가 컨테이너를 사용하는 동안에 생기는 데이터들은 컨테이너 레이어에 있고, 이는 컨테이너가 종료될 때 삭제된다.
    
    도커파일 한 줄, 한 줄이 대부분 이미지 레이어를 만듬.
    
    여러 이미지를 기반으로 서비스하고자 한다면, compose를 활용한다.
    
    [https://www.youtube.com/watch?v=qNXcGqixPMk&t=78s](https://www.youtube.com/watch?v=qNXcGqixPMk&t=78s)
    
- **볼륨**
    
    주로 도커 컨테이너에서 생성되고 사용된 데이터를 보존하기 위해 사용되는 방법이다. 이외에 여러 컨테이너간의 데이터를 공유해야할 때, 도커 호스트에 지정된 디렉토리가 보장되지 않을 때(컨테이너에만 있는 경우) 등
    
    [https://docs.docker.com/storage/](https://docs.docker.com/storage/)
    
- **Docker Daemon**
    
    Docker 데몬(dockerd)은 API 요청을 수신하고 이미지, 컨테이너, 네트워크 및 볼륨과 같은 Docker 객체를 관리
    
    ![Untitled](Docker%2087aecf79b0614485a6b927217a246d31/Untitled.png)
    
- **컨테이너 오케스트레이션**
    
    [https://www.youtube.com/watch?v=Ia8IfowgU7s](https://www.youtube.com/watch?v=Ia8IfowgU7s)
    
    - 도커 사용 이유
        
        가상머신과 비교해 컨테이너 생성이 쉽고 효율적
        
        이미지를 이용한 배포 롤백 간단
        
        언어/프레임워크/버전/클라우드 벤더에 독립
        
        개발/테스팅/운영 환경/로컬/클라우드 동일한 환경 구축 가능
        
    - 컨테이너 관리의 필요성
        
        컨테이너들의 버전 관리 일부 전체(롤인, 롤백)
        
        새로운 컨테이너 추가 & 프록시 서버와 IP 주소 바인딩
        
        컨테이너 이상 / 부하 모니터링
        
    - 컨테이너 오케스트레이션
        
        위의 문제를 클러스터 단위로 묶어 관리하는 것이 컨테이너 오케스트레이션이다.
        
        클러스터는 컨테이너화 된 애플리케이션을 실행하는 노드들을 말하며, 모든 클러스터는 하나 이상의 워커 노드를 가진다.